import { useMemo, useRef } from 'react';
import { v4 as uuid } from 'uuid';

export const WaterfallBooks = ({ images }) => {
  const keysRef = useRef(new Map());

  const imagesWithKeys = useMemo(() => {
    return images.map(image => {
      if (!keysRef.current.has(image.src)) {
        keysRef.current.set(image.src, uuid());
      }
      return { ...image, key: keysRef.current.get(image.src) };
    });
  }, [images]);

  return (
    <div className="relative">
      {imagesWithKeys.map(image => (
        <img
          key={image.key}
          src={image.src}
          alt={image.alt || ''}
          className={`absolute ${image.className || ''}`}
          loading="lazy"
        />
      ))}
    </div>
  );
};
